<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="referrer" content="never">
    <title>Document</title>
</head>
<style>
    * {
        padding: 0;
        margin: 0;
    }

    .tpl {
        display: none;
    }

    .wrapper {
        overflow: hidden;
        border: 2px solid black;
        width: 600px;
        margin: 100px auto 0px;
    }

    .movieSection {
        float: left;
        width: 180px;
        height: 180px;
        padding: 10px;
    }

    .movieSection img {
        width: 100%;
        height: 150px;
        cursor: pointer;
    }

    .movieSection h3 {
        height: 30px;
    }
</style>
<body>
<div class="wrapper">
    <div class="tpl">
        <img src="" alt=""/>
        <h3 class="movieName"></h3>
    </div>
</div>
<script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
<script>
    const baseUrl = 'http://rap2api.taobao.org/app/mock/236728';
    const doubanUrl = 'https://api.douban.com';
    const apiKey = '0df993c66c0c636e29ecbb5344252a4a';
    const $Wrapper = $('.wrapper');

    $.ajax({
        url: `${baseUrl}/user/recognize`,
        type: 'GET',
        data: {
            username: 'zhangl',
            password: '123456',
        },
        success: function (res) {
            const { data, state } = res;

            if (state) return false;

            const { isLegal, nextUrl } = data;

            if (!isLegal) return false;

            $.ajax({
                url: nextUrl,
                data: {
                    start: 10,
                    count: 6,
                    apikey: apiKey,
                },
                dataType: 'jsonp',
                success: function (res) {
                    const { subjects } = res;
                    console.log(res);
                    for (let i = 0; i < subjects.length; i++) {
                        const item = subjects[i];
                        const tpl = $('.tpl').clone()
                                             .addClass('movieSection')
                                             .removeClass('tpl');

                        tpl.data({
                            id: item.id,
                        })
                           .on('click', function () {
                               const id = $(this).data('id');

                               $.ajax({
                                   url: `${doubanUrl}/v2/movie/subject/${id}`,
                                   dataType: 'jsonp',
                                   data: {
                                       apikey: apiKey,
                                   },
                                   success: function (res) {
                                       const {
                                           directors, // 导演
                                           casts, // 演员
                                           writers, // 编剧
                                           summary, // 剧情
                                       } = res;
                                       const htmlStr = `
                                            <div class="mask">
                                                <p>导演: ${directors.map(item => item.name).join('/')}</p>
                                                <p>剧情: ${summary}</p>
                                                <p>主演: ${casts.map(item => item.name).join('/')}</p>
                                                <p>编剧: ${writers.map(item => item.name).join('/')}</p>
                                            </div>
                                        `;

                                       $('.mask').remove();
                                       $(htmlStr)
                                           .appendTo('body')
                                           .css({
                                               position: 'absolute',
                                               left: $(window).outerWidth() / 2,
                                               bottom: 20,
                                               width: 400,
                                               marginLeft: -200,
                                           });
                                   },
                               });
                           })
                           .children()
                           .eq(0)
                           .attr('src', item.images.small)
                           .next()
                           .text(item.title);

                        $Wrapper.append(tpl);
                    }
                },
            });
        },
    });
</script>
</body>
</html>